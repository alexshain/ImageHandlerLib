# ImageHandlerLib

# Библиотека: цифровые изображения горных пород

## Введение

В данном фале представлено описание модуля, разработанного для обработки изображения горных пород, которые необходимы в дальнейшем для моделирования течения в пористой среде, оценке эффективной проницаемости среды и т.п. 

// Поэтому предполагается, что у читателя не возникнет вопросов по поводу слов и фраз: "порода", "основное направление течения" и т.п.

Основные разделы файла:
1. Формат файла изображения - описание хранения изображения и индексации пикселей.
2. Классы - описание классов и их методов.
3. Консольное приложение - описание приложения.

## Формат файла изображения

### Хранение

Изображение хранится в бинарном файле.

Первые 8 байт представляют собой беззнаковый целый тип – размер изображения N1 по первому измерению.

Вторые 8 байт - размер изображения N2 по второму направлению.

Далее следует N1*N2 пикселей изображения. Один пиксель занимает 1 байт. Пиксель со значением 0 соответствует поре, 255 – породе.

Для трехмерного случая – аналогично (добавляется еще 8 байт для третьего измерения)

### Порядок пикселей изображения

По умолчанию считается, что N1 - это количество узлов в направлении оси x (горизонтальной), сонаправленной с основным направлением течения, а N2 - количество узлов в направлении оси y (вертикальной), перпендикулярной основному направлению течения. 

Нумерация следующая: быстрый индекс по x, медленный по y.

Таблица, представленная ниже, иллюстрирует используемую нумерация. В данном случае N1 = 6, N2 = 5.

| 0 | 1 | 2 | 3 | 4 | 5 |
| - | - | - | - | - | - |
| 6 | 7 | 8 | 9 | 10 | 11 |
| 12 | 13 | 14 | 15 | 16 | 17 |
| 18 | 19 | 20 | 21 | 22 | 23 |
| 24 | 25 | 26 | 27 | 28 | 29 |

Примечание: 
Пиксели 0-5 и 24-29 должны быть стенками.

Для трехмерного случая все аналогично, самый медленный индекс по z.

## Модули

В данной библиотеке два основных модуля: 
1. image_handler - содержит классы и методы для обработки готовых изображений горной породы
2. standard_image_lib - подбиблиотека, генерирующая стандартный изображения. Предполагается, что на данных стандартных изображениях будет отлаживаться работа решателей уравнения Стокса.

Ниже представлено чуть более подробное описание модулей.

### Функционал модуля image_handler

Модуль содержит интерфейс ImageHandler с виртуальным методом handle, от которого наследуются следующие классы:
1. AddWallsHandler - добавляет "стенки" сверху и снизу к изображению породы (имитация помещения образца в лабораторную камеру)
2. CutOutAreaHandler - вырезает подобласть подаваемого на вход изображения
3. RemoveClosedPoresHandler - удаляет замкнутые поры в среде 

Класс slice3DImage не реализует интерфейс imageHandler т.к имеет немного отличный функционал. Методы класса могут считать трехмерное изображение породы и по номеру слоя произвести разрес породы (число слоев определяется разрешением исходного изображения).

### Функционал модуля standard_image_lib

Модуль содержит абстрактный класс SandardImage с абстрактным методом getImage и содержащий поля:
1. std::vector<uint8_t> image_ - контейнер, хранящий изобрадения породы (см. пункт "Хранение");
2. int resolution_ - поле, содержащее разрешение (квадратного) изображения. Вводится пользователем;
3. const double SIZE_ = 1 - вспомогательное поле "фиктивного размера", необходимое для заполнения image_ нужными значениями;

От SandardImage наследуются:
1. Circle - создает круг с центре области (состоящий из твердой породы) и стенки на верхней и на нижней гранях
2. SinusoidalChannel - создает среду с синусоидальным каналом
3. TwoChannels - создает среду с двумя каналами, ширина которых задается пользователем 
(метод setWidths(int first_width, int second_width))

## Консольное приложение
Приложение реализует интуитивно понятный интерфейс, включающий пояснения к вводимым параметрам и возможностям приложения. Для начала работы необходимо произвести сборку проекта (см. пункт "Установка и Сборка") и запустить исполняемый файл

Ниже перечислен его основной функционал:
1.	Получить от пользователя путь ко входному 2D изображению. Считать изображение, добавить стенки, вывести в файл указанный пользователем;
2.	Получить от пользователя путь ко входному 2D изображению. Получить от пользователя конфигурации подобласти для вырезания. Вывести подобласть в файл указанный пользователем;
3.	Получить от пользователя путь ко входному 3D изображению. Получить от пользователя конфигурации слайса. Вывести слайс файл указанный пользователем;
4.	Получить от пользователя путь ко входному 2D изображению. Удалить замкнутые поры (пометить их как породу). Вывести в файл указанный пользователем;
5.	Получить от пользователя тип и параметры стандартного изображения. Вывести его в файл указанный пользователем.

Примечание:  
В путях к файлам не следует использовать побелы и кириллицу!

## Установка и Сборка

### Установка
Для установки и использования этого проекта клонируйте репозиторий:

```bash
git clone https://github.com/alexshain/Quaternions.git
```

Затем соберите проект, используя CMake:

### Сборка
Перейдите в каталог проекта и создайте папку для сборки:

```bash
mkdir build
cd build
cmake ..
make
```

## Визуализация 
В директории /python содержиться код на языке python, который производит чтение бинарных файлов, содержащих двумерное изображение и производит их визуализацию 

для чтения вашего файла необходимо правильно указать путь (file_path = 'ваш бинарный файл')

## Примеры изображений
В директории /data хранятся исходные трехмерные изображения (/data/sourse) и некоторые примеры обработанных изображений 
(/data/handled)